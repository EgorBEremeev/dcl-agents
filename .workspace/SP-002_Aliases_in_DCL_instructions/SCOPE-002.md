# SCOPE-002: Aliases in DCL instructions

**Sprint:** SP-002  
**Created:** 2025-12-16  
**Status:** Completed (ретроспективная документация)

---

## Описание задачи

Адаптировать `dcl-agent` к обновленной структуре `dcl-bundle`, обеспечив поддержку алиасов (коротких имен), определенных в `index.yaml`, и конфигураций с множественными бандлами. Реализовать стратегию разрешения конфликтов **First-Wins** (первый побеждает) для дубликатов модулей и алиасов.

**Бизнес-цель:** Упростить написание DCL-инструкций, позволив использовать короткие алиасы (например, `WRITE`) вместо полных версионированных ID (например, `dcl-god-mode/operations/write/4.0`). Обеспечить возможность комбинирования Core и Domain бандлов.

**Ожидаемые результаты:**
- Поддержка загрузки множественных бандлов (список путей)
- Разрешение алиасов из `index.yaml`
- Стратегия First-Wins для дубликатов (с Warning'ами)
- Валидация алиасов после загрузки всех бандлов
- Обновленные тесты с покрытием новой функциональности

---

## Тип задачи

- [ ] **New Development** (создание с нуля)
- [x] **Enhancement** (расширение существующего решения)

---

## Базовые артефакты

*Артефакты, использованные как отправная точка для этого спринта:*

| Артефакт | ID | Версия | Расположение |
|----------|------|---------|--------------|
| Requirements | REQ-001 | v1.0 | `.workspace/SP-001_dcl_agent_implementation/REQ-001_DCL Agent.md` |
| Technical Design | TSD-001 | v1.0 | `.workspace/SP-001_dcl_agent_implementation/TSD-001_DCL_Agent.md` |

**Примечание:** IMP-001 используется только как справочный материал, не требует обновления.

---

## Затронутые компоненты

[Список компонентов системы, которые будут изменены или созданы в этом спринте]

- **Registry** (enhancement: добавление поддержки алиасов, стратегии First-Wins, валидации)
- **Loader** (enhancement: загрузка нескольких бандлов, парсинг `index.yaml`)
- **DCLAgent (Facade)** (enhancement: обновление инициализации для списка бандлов)
- **Exceptions** (new: иерархия исключений `DCLConfigurationError` и `DCLConfigurationWarning`)
- **Parser** (no changes: остается агностичным)
- **Strategies** (no changes)
- **Adapters** (no changes)

---

## Выходные артефакты

*Артефакты, которые будут созданы/обновлены в ходе этого спринта:*

| Артефакт | ID | Действие | Описание |
|----------|------|----------|----------|
| Requirements | REQ-002 | New | Требования к поддержке алиасов и multi-bundle |
| Technical Design | TSD-002 | New | Дизайн разрешения алиасов, стратегии First-Wins |
| Implementation Plan | IMP-002 | New | Бэклог задач для реализации |
| Walkthrough | walkthrough-002 | New | Итоги спринта, результаты верификации |

---

## Риски регрессии

[Существующие тесты, скрипты или функциональность, которые могут быть затронуты изменениями и должны быть проверены на этапе Verification]

**Unit тесты:**
- `tests/test_registry.py` — могут потребоваться изменения из-за добавления методов алиасов в Registry
- `tests/test_loader.py` — должны остаться работоспособными (single-bundle) и дополниться тестами для multi-bundle
- `tests/test_parser.py` — не должны быть затронуты (парсер агностичен к алиасам)

**Integration тесты:**
- `verify_agent.py` — должен быть обновлен для тестирования загрузки реальных бандлов (`dcl-core` + `dcl-god-mode`)

**Бэквард-совместимость:**
- Агент должен продолжать работать с single-bundle конфигурациями (одиночный путь к бандлу)

---

## Утверждение

- [x] Пользователь рассмотрел и утвердил scope
- [x] Агент может приступить к Stage 1: Requirements Elaboration
- [x] Спринт завершен (артефакты опубликованы)
