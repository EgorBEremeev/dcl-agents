# TSD-004: Упаковка и поддержка Notebook

**Версия:** 1.0
**Спринт:** SP-004
**Дата:** 2025-12-26

---

## 1. Контекст и Область действия

Описывает техническую реализацию упаковки агента в Python-пакет и обновление ноутбуков для его использования.
**Цель:** Обеспечить стандартный import `dcl_agent` без манипуляций с `sys.path` в локальной среде и Colab.

---

## 2. Архитектурные решения

### 2.1 Структура Пакета
Принято решение использовать стандарт `pyproject.toml` (PEP 621) с backend `setuptools`. Пакет будет "rootless" (без setup.py), вся конфигурация в toml.

**Расположение:** `src/dcl_agent/pyproject.toml`
Почему здесь, а не в корне repo?
- В корне репо сейчас сложная структура (`dcl-core`, `dcl-god-mode`, `notebooks` и т.д.).
- Мы упаковываем конкретно *реализацию агента* (`src/dcl_agent`), а не весь монорепозиторий.

### 2.2 Управление зависимостями
Зависимости определяются в `dependencies` секции `pyproject.toml`.
Это позволяет при установке пакета (через pip) автоматически подтянуть `lark`, `google-genai` и др.

### 2.3 Deployment Flow

**Сценарий А: Локальная разработка**
Разработчик устанавливает пакет в режиме редактирования:
```bash
pip install -e src/dcl_agent
```
Это создает egg-info и делает пакет доступным глобально в venv.

**Сценарий Б: Google Colab**
Пользователь клонирует репозиторий и устанавливает пакет из него:
```python
!git clone https://github.com/EgorBEremeev/dcl.git
!pip install -e dcl/src/dcl_agent
```
*Примечание: Поскольку репозиторий приватный или требует токена, в Colab может потребоваться явная передача токена или использование публичного зеркала. В рамках TSD предполагаем, что доступ к репозиторию есть.*

---

## 3. Детализация компонентов

### 3.1 Файл `pyproject.toml`
**Содержание:**
- `build-system`: requires setuptools, wheel.
- `project`: metadata (name="dcl-agent", version="0.1.0"), dependencies, requires-python=">=3.12".
- `tool.setuptools`: discovery (автопоиск пакетов).

### 3.2 Обновление `dcl-agent.ipynb`

**Изменения:**
1.  **Setup Cell:** Добавить блок кода, который определяет среду (Colab vs Local) и предлагает инструкции/команды установки.
2.  **Imports:** Заменить:
    ```python
    import sys
    sys.path.append(...)
    ```
    на:
    ```python
    from dcl_agent.agent import DCLAgent
    from dcl_agent.config import ...
    ```

---

## 4. API Контракты
Без изменений. Публичный API `DCLAgent` сохраняется.

---

## 5. Открытые вопросы
Нет.
