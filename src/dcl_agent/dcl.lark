
// DCL Grammar v2.2
// Based on sys/frameworks/dcl_grammar

start: instruction

instruction: action_clause source_clause? modifier_clause? goal_clause?

action_clause: operator_id operand

// Operand: Can be a typed entity (PromptModule('id')) or a simple object expression (string/id)
operand: entity_expression | object_expression

// Entity Expression: Type('Args') - Universal Functional Syntax
// e.g. PromptModule('sys/ops/write')
entity_expression: IDENTIFIER "(" arguments ")"

// Arguments: Loose content inside parentheses (everything except closing paren)
// We capture it as a single string for now to be robust
arguments: /[^)]+/

// Operator ID can be a simple identifier or namespaced
operator_id: IDENTIFIER | NAMESPACED_ID

// Object expression is currently just a string/identifier, possibly quoted
object_expression: resource_id

source_clause: "FROM" resource_list
modifier_clause: "USING" resource_list
goal_clause: "OPTIMIZING_FOR" resource_list

resource_list: resource_expression ("," resource_expression)*

// Resource Expression: Type('ID') or 'ID'
resource_expression: (resource_type "(" resource_id ")") | resource_id

resource_type: IDENTIFIER
resource_id: STRING | IDENTIFIER | NAMESPACED_ID

// Identifiers
// Simple ID: alphanumeric + underscore
IDENTIFIER: /[a-zA-Z_][a-zA-Z0-9_]*/
// Namespaced ID: Must contain at least one slash
NAMESPACED_ID: /[a-zA-Z0-9_]+(\/[a-zA-Z0-9_.-]+)+/

STRING: /'[^']*'/ | /"[^"]*"/

%import common.WS
%ignore WS
